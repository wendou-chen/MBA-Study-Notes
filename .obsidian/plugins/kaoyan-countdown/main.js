var x=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var M=(n,s)=>{for(var e in s)x(n,e,{get:s[e],enumerable:!0})},P=(n,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let a of S(s))!L.call(n,a)&&a!==e&&x(n,a,{get:()=>s[a],enumerable:!(t=j(s,a))||t.enumerable});return n};var C=n=>P(x({},"__esModule",{value:!0}),n);var O={};M(O,{default:()=>u});module.exports=C(O);var T=require("obsidian");var E=require("obsidian");var I=[{id:1,name:"\u57FA\u7840\u592F\u5B9E",startDate:"2026-02-14",endDate:"2026-04-20",allocation:{math:.55,major:.2,english:.1,competition:.15}},{id:2,name:"\u57FA\u7840\u6536\u5C3E",startDate:"2026-04-21",endDate:"2026-06-30",allocation:{math:.5,major:.25,english:.1,review:.15}},{id:3,name:"\u5F3A\u5316\u7A81\u7834",startDate:"2026-07-01",endDate:"2026-09-30",allocation:{math:.4,major:.25,english:.15,politics:.15,review:.05}},{id:4,name:"\u51B2\u523A\u6A21\u8003",startDate:"2026-10-01",endDate:"2026-11-30",allocation:{math:.35,major:.25,english:.15,politics:.2,review:.05}},{id:5,name:"\u8003\u524D\u6536\u5B98",startDate:"2026-12-01",endDate:"2026-12-20",allocation:{math:.3,major:.2,english:.15,politics:.3,review:.05}}],$=[{month:"2026.03",items:["\u9AD8\u6570\u4E0A\u518C\u5168\u4E66\u4E00\u5237\u5B8C\u6210","\u4FE1\u53F7\u4E0E\u7CFB\u7EDF\u524D 4 \u7AE0\u901A\u8BFB"]},{month:"2026.04",items:["\u9AD8\u6570\u4E0B\u518C\u5168\u4E66\u4E00\u5237\u5B8C\u6210","\u5927\u5510\u676F/\u84DD\u6865\u676F\u6BD4\u8D5B\u7ED3\u675F"]},{month:"2026.05",items:["\u7EBF\u6027\u4EE3\u6570\u5168\u4E66\u4E00\u5237\u5B8C\u6210","\u4FE1\u53F7\u4E0E\u7CFB\u7EDF\u524D 8 \u7AE0\u901A\u8BFB"]},{month:"2026.06",items:["\u6982\u7387\u8BBA\u5168\u4E66\u4E00\u5237\u5B8C\u6210","\u5168\u4E66\u4E8C\u5237\u542F\u52A8","\u4FE1\u53F7\u6559\u6750\u901A\u8BFB\u5B8C\u6BD5"]},{month:"2026.07",items:["\u5168\u4E66\u4E8C\u5237\u8FC7\u534A","\u653F\u6CBB\u7CBE\u8BB2\u7CBE\u7EC3\u542F\u52A8","\u82F1\u8BED\u9605\u8BFB\u8BAD\u7EC3\u542F\u52A8"]},{month:"2026.08",items:["\u5168\u4E66\u4E8C\u5237\u5B8C\u6210","\u4FE1\u53F7\u771F\u9898\u4E00\u5237\u542F\u52A8","\u653F\u6CBB 1000 \u9898\u8FC7\u534A"]},{month:"2026.09",items:["\u6570\u5B66\u771F\u9898\u4E00\u5237\u5B8C\u6210","\u4FE1\u53F7\u771F\u9898\u4E00\u5237\u5B8C\u6210","\u653F\u6CBB 1000 \u9898\u5B8C\u6210"]},{month:"2026.10",items:["\u9996\u6B21\u5168\u79D1\u6A21\u8003","\u82F1\u8BED\u4F5C\u6587\u6A21\u677F\u6210\u578B","\u653F\u6CBB\u80CC\u8BF5\u542F\u52A8"]},{month:"2026.11",items:["\u6A21\u8003 3 \u8F6E\u4EE5\u4E0A","\u5404\u79D1\u67E5\u6F0F\u8865\u7F3A\u6E05\u5355\u751F\u6210"]},{month:"2026.12",items:["\u8003\u524D\u6700\u7EC8\u6A21\u8003","\u653F\u6CBB\u62BC\u9898\u5377","\u5FC3\u6001\u8C03\u6574"]}];function v(n){let s=new Date(n+"T00:00:00"),e=new Date;return e.setHours(0,0,0,0),Math.ceil((s.getTime()-e.getTime())/(1e3*60*60*24))}function D(n){var e;let s=new Date(n);return s.setHours(0,0,0,0),(e=I.find(t=>{let a=new Date(t.startDate+"T00:00:00"),o=new Date(t.endDate+"T00:00:00");return s>=a&&s<=o}))!=null?e:null}function b(n,s){let e=new Date(n.startDate+"T00:00:00").getTime(),t=new Date(n.endDate+"T00:00:00").getTime(),a=new Date(s).setHours(0,0,0,0);return Math.min(1,Math.max(0,(a-e)/(t-e)))}function y(n){var e;let s=`${n.getFullYear()}.${String(n.getMonth()+1).padStart(2,"0")}`;return(e=$.find(t=>t.month===s))!=null?e:null}var k={math:"\u6570\u5B66",major:"\u4E13\u4E1A\u8BFE",english:"\u82F1\u8BED",politics:"\u653F\u6CBB",competition:"\u7ADE\u8D5B",review:"\u6A21\u8003/\u590D\u76D8"},A=[{id:"m1",subject:"math",text:"\u9AD8\u6570\u4E0A\u518C\u5168\u4E66\u4E00\u5237",completed:!1},{id:"m2",subject:"math",text:"\u9AD8\u6570\u4E0B\u518C\u5168\u4E66\u4E00\u5237",completed:!1},{id:"m3",subject:"math",text:"\u7EBF\u6027\u4EE3\u6570\u5168\u4E66\u4E00\u5237",completed:!1},{id:"m4",subject:"math",text:"\u6982\u7387\u8BBA\u5168\u4E66\u4E00\u5237",completed:!1},{id:"m5",subject:"math",text:"\u5168\u4E66\u4E8C\u5237",completed:!1},{id:"m6",subject:"math",text:"\u6570\u5B66\u771F\u9898\u4E00\u5237",completed:!1},{id:"j1",subject:"major",text:"\u4FE1\u53F7\u4E0E\u7CFB\u7EDF\u6559\u6750\u901A\u8BFB",completed:!1},{id:"j2",subject:"major",text:"\u4FE1\u53F7\u4E0E\u7CFB\u7EDF\u771F\u9898\u4E00\u5237",completed:!1},{id:"e1",subject:"english",text:"\u5355\u8BCD 5500 \u8FC7\u4E00\u904D",completed:!1},{id:"e2",subject:"english",text:"\u82F1\u8BED\u9605\u8BFB\u8BAD\u7EC3",completed:!1},{id:"e3",subject:"english",text:"\u4F5C\u6587\u6A21\u677F\u6210\u578B",completed:!1},{id:"p1",subject:"politics",text:"\u7CBE\u8BB2\u7CBE\u7EC3 + 1000 \u9898",completed:!1},{id:"p2",subject:"politics",text:"\u653F\u6CBB\u80CC\u8BF5",completed:!1},{id:"p3",subject:"politics",text:"\u62BC\u9898\u5377",completed:!1}],w={examDate:"2026-12-20",tasks:A,completedMilestones:[],showAllocation:!0};var l="kaoyan-countdown-view",g=class extends E.ItemView{constructor(e,t){super(e);this.refreshInterval=0;this.plugin=t}getViewType(){return l}getDisplayText(){return"\u8003\u7814\u5012\u8BA1\u65F6"}getIcon(){return"clock"}async onOpen(){this.render(),this.refreshInterval=window.setInterval(()=>this.render(),6e4),this.registerInterval(this.refreshInterval)}async onClose(){}render(){let e=this.contentEl;e.empty(),e.addClass("kaoyan-countdown-container"),this.renderCountdown(e),this.renderPhase(e),this.renderTasks(e)}renderCountdown(e){let t=e.createDiv({cls:"kc-countdown-section"}),a=v(this.plugin.settings.examDate);t.createEl("div",{cls:"kc-title",text:"\u{1F3AF} \u8003\u7814\u5012\u8BA1\u65F6"}),t.createEl("div",{cls:"kc-days",text:`${a}`}),t.createEl("div",{cls:"kc-days-label",text:"\u5929"}),t.createEl("div",{cls:"kc-exam-date",text:`\u8003\u8BD5\u65E5\u671F\uFF1A${this.plugin.settings.examDate}`})}renderPhase(e){let t=e.createDiv({cls:"kc-phase-section"}),a=new Date,o=D(a);if(!o){t.createEl("div",{cls:"kc-phase-name",text:"\u5F53\u524D\u4E0D\u5728\u4EFB\u4F55\u9636\u6BB5\u8303\u56F4\u5185"});return}let p=b(o,a);t.createEl("div",{cls:"kc-phase-name",text:`\u{1F4CD} Phase ${o.id} ${o.name}`}),t.createEl("div",{cls:"kc-phase-range",text:`${o.startDate} \u2192 ${o.endDate}`});let i=t.createDiv({cls:"kc-progress-bar"}).createDiv({cls:"kc-progress-fill"});if(i.style.width=`${Math.round(p*100)}%`,t.createEl("div",{cls:"kc-progress-text",text:`${Math.round(p*100)}%`}),this.plugin.settings.showAllocation){let m=t.createDiv({cls:"kc-allocation"});for(let[r,c]of Object.entries(o.allocation))if(c&&c>0){let d=k[r]||r;m.createEl("span",{cls:"kc-alloc-tag",text:`${d} ${Math.round(c*100)}%`})}}}renderTasks(e){let t=e.createDiv({cls:"kc-tasks-section"}),o=y(new Date);if(o){t.createEl("div",{cls:"kc-section-title",text:`\u{1F4CB} ${o.month} \u91CC\u7A0B\u7891`});for(let i of o.items){let m=t.createDiv({cls:"kc-task-row"}),r=m.createEl("input",{type:"checkbox"});r.checked=this.plugin.settings.completedMilestones.includes(i),r.addEventListener("change",async()=>{let c=this.plugin.settings.completedMilestones;r.checked?c.includes(i)||c.push(i):this.plugin.settings.completedMilestones=c.filter(d=>d!==i),await this.plugin.saveSettings()}),m.createEl("span",{text:i,cls:r.checked?"kc-completed":""})}}t.createEl("div",{cls:"kc-section-title",text:"\u{1F4CB} \u5F85\u529E\u77E5\u8BC6\u70B9"});let p=this.plugin.settings.tasks,h={};for(let i of p)(h[i.subject]=h[i.subject]||[]).push(i);for(let[i,m]of Object.entries(h)){let r=k[i]||i;t.createEl("div",{cls:"kc-subject-label",text:r});for(let c of m){let d=t.createDiv({cls:"kc-task-row"}),f=d.createEl("input",{type:"checkbox"});f.checked=c.completed,f.addEventListener("change",async()=>{c.completed=f.checked,await this.plugin.saveSettings(),this.render()}),d.createEl("span",{text:c.text,cls:c.completed?"kc-completed":""})}}}};var u=class extends T.Plugin{constructor(){super(...arguments);this.settings=w}async onload(){await this.loadSettings(),this.registerView(l,e=>new g(e,this)),this.addRibbonIcon("clock","\u8003\u7814\u5012\u8BA1\u65F6",()=>{this.activateView()}),this.addCommand({id:"open-kaoyan-countdown",name:"\u6253\u5F00\u8003\u7814\u5012\u8BA1\u65F6",callback:()=>this.activateView()}),this.app.workspace.onLayoutReady(()=>{this.app.workspace.getLeavesOfType(l).length===0&&this.activateView()})}onunload(){this.app.workspace.detachLeavesOfType(l)}async activateView(){let{workspace:e}=this.app,t=e.getLeavesOfType(l);if(t.length>0){e.revealLeaf(t[0]);return}let a=e.getRightLeaf(!1);a&&(await a.setViewState({type:l,active:!0}),e.revealLeaf(a))}async loadSettings(){this.settings=Object.assign({},w,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
