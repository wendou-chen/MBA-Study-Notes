# 任务：完成 error-collector Obsidian 插件

## 背景

`考研数学/解题板.md` 是 AI 解题的输出文件，每次解题后写入题目图片 + 完整 LaTeX 解答。
用户希望在解题板中勾选一个 checkbox，Obsidian 插件自动将该题收录到对应章节的错题本。

## 当前状态

- ✅ `.obsidian/plugins/error-collector/manifest.json` — 已创建
- ❌ `.obsidian/plugins/error-collector/main.js` — **尚未创建，这是本次的核心任务**
- ❌ `math-problem-solver` SKILL.md 需要补充"收录 checkbox"的追加规则

---

## 任务 1：创建 `.obsidian/plugins/error-collector/main.js`

### 插件功能

监听 `考研数学/解题板.md` 的文件保存事件。当文件中出现被勾选的 checkbox：

```
- [x] 收录到错题本 · <章节名>
```

自动执行以下收录流程：

### 收录流程

1. **解析解题板**，提取：
   - 题目图片路径（文件中第一个 `![[...]]` 嵌入）
   - 题目描述（`**📝 题目**` 段落下的文字）
   - 章节名（勾选的 checkbox 行中 `·` 后的文字，例如 `微分方程`）
   - 最终答案（`**✅ 最终答案**` 段落下的内容）

2. **复制图片** 到 `考研数学/错题/<章节名>/images/`

3. **追加错题记录** 到 `考研数学/错题/<章节名>/<章节名>错题.md` 末尾

4. **清除 checkbox 勾选**（将 `- [x]` 改回 `- [ ]`），避免重复触发

### 追加的错题记录格式

```markdown

---

## 题目 · {{YYYY-MM-DD}}

![[images/<图片文件名>]]

**知识点**：<章节名>
**错误原因**：（待填写）
**解题关键**：<从解题板"解题思路"段落自动提取第一句话>

> [!success] 答案
> <最终答案内容>
```

### 章节固定列表

插件识别以下章节名（用于目录匹配）：

```
微分方程
无穷级数
多元函数积分
一元函数积分
微分学
线性代数
概率论
```

若章节目录不存在，自动创建 `考研数学/错题/<章节名>/` 和 `images/` 子目录。

### 参考文件（供了解结构和风格）

- `考研数学/错题/微分方程/微分方程错题.md` — 现有错题格式
- `.obsidian/plugins/kaoyan-countdown/main.js` — 参考插件代码结构
- `.obsidian/plugins/error-collector/manifest.json` — 已有 manifest

---

## 任务 2：更新 math-problem-solver SKILL.md

在以下两个文件的 `## 输出规则` 章节末尾追加「收录选项」规则：

- `.claude/skills/math-problem-solver/SKILL.md`
- `.agent/skills/math-problem-solver/SKILL.md`

### 追加内容

```markdown
### 收录选项（每次解题后追加到解题板末尾）

解题完成、写入 `考研数学/解题板.md` 后，在文件末尾**再追加**以下内容：

    ## 📥 收录到错题本？

    - [ ] 收录到错题本 · <自动推断的最可能章节>
    - [ ] 收录到错题本 · <次选章节>（如有）

章节从以下固定列表中选择：微分方程 / 无穷级数 / 多元函数积分 / 一元函数积分 / 微分学 / 线性代数 / 概率论

根据题目内容自动推断，最多列出 2 个选项。用户在 Obsidian 中勾选后，插件自动收录。
```

---

## 验证步骤

1. 在 Obsidian 中启用 `error-collector` 插件（设置 → 第三方插件）
2. 打开 `考研数学/解题板.md`，勾选 `- [ ] 收录到错题本 · 微分方程`
3. 保存文件，插件应自动：
   - 在 `考研数学/错题/微分方程/images/` 中出现图片副本
   - 在 `考研数学/错题/微分方程/微分方程错题.md` 末尾追加一条错题记录
   - checkbox 被重置为 `- [ ]`
