---
name: weekly-review
description: 周复盘自动生成器。聚合本周每日计划数据，交叉引用新增错题，生成结构化周复盘报告。当用户说"/周复盘"、"本周复盘"、"周日复盘"时触发。
---

# 周复盘自动生成器

自动聚合一周数据，暴露系统性问题，防止"每天感觉还行但一周下来没进展"。

## 触发

- 用户输入 `/周复盘` 或 "本周复盘"
- 周日晚间用户说"复盘"时，planner 可联动调用

## 工作流

### 1. 确定周范围

计算本周一到周日的日期范围（ISO 周，周一起始）。
如果今天不是周日，则统计"本周一至今天"的数据，并标注为"周中快照"。

### 2. 读取每日计划文件

用 Glob 查找 `考研计划/YYYY-MM-DD*.md`，筛选日期在本周范围内的文件。

对每个文件：
- 读取 frontmatter（`status`、`phase`）
- 用 dailyParser.ts 同款正则解析任务完成情况：

```
CHECKLIST_RE = /^- \[([ xX])\]\s*(.+?)\s*\|\s*(.+?)\s*\|\s*(.+)/
TABLE_ROW_RE = /^\|\s*(.+?)\s*\|\s*(.+?)\s*\|\s*(.+?)\s*\|(⬜|✅)\s*\|/
```

- 统计：总任务数、已完成数、按科目分组的完成情况
- 解析晚间复盘表（如有填写）：数学用时、题量、单词数等

### 3. 交叉引用本周新增错题

扫描 `考研数学/错题/*/images/` 下所有图片，提取文件名日期在本周范围内的图片。
反向查找对应错题条目，统计：
- 本周新增错题数
- 按章节分布
- 高频错误知识点（错误次数 ≥ 2 的）

### 4. 生成周复盘报告

输出文件：`考研计划/周复盘/YYYY-WXX 周复盘.md`

如果 `考研计划/周复盘/` 目录不存在，自动创建。

### 5. 报告模板

```markdown
---
date: YYYY-MM-DD
type: weekly-review
week: YYYY-WXX
phase: N
week_start: YYYY-MM-DD
week_end: YYYY-MM-DD
tags: [weekly-review, phase-N]
---

# 📊 YYYY 第 XX 周复盘（MM.DD — MM.DD）

> [!tip] 一句话总结
> **（根据数据自动生成的本周核心结论）**

---

## 📈 完成率总览

| 日期 | 星期 | 总任务 | 已完成 | 完成率 |
|:----:|:----:|:------:|:------:|:------:|
| MM-DD | 周一 | N | N | XX% |
| ... | ... | ... | ... | ... |
| **合计** | — | **N** | **N** | **XX%** |

---

## 📚 科目分析

| 科目 | 任务数 | 完成数 | 完成率 | 备注 |
|:----:|:------:|:------:|:------:|:----:|
| 🔢 数学 | N | N | XX% | |
| 🔤 英语 | N | N | XX% | |
| 📡 专业课 | N | N | XX% | |
| 📕 政治 | N | N | XX% | |

---

## ❌ 本周新增错题

| 章节 | 新增数 | 高频知识点 |
|:----:|:------:|:----------:|
| 微分方程 | N | 知识点A, 知识点B |
| ... | ... | ... |

> [!warning] 错题警告
> （如有高频错误知识点，在此标注预警）

---

## 🔍 问题诊断

> [!danger] 系统性问题
> （自动检测并列出，例如：）
> - 专业课连续 X 天未推进
> - 数学完成率连续下降
> - 某科目 0 任务分配

> [!note] 缺失天数
> 本周有 X 天无计划文件：周X、周X

---

## 🎯 下周建议

基于本周数据，建议下周重点：
1. （根据薄弱科目和错题分布自动生成）
2. （根据完成率趋势自动生成）
3. （根据 planner 阶段目标对齐检查自动生成）

---

## 🔗 关联
- 上周复盘：[[YYYY-WXX 周复盘]]
- 本周计划：[[YYYY-MM-DD 周一]] ~ [[YYYY-MM-DD 周日]]
```

## 自动诊断规则

生成报告时，自动检测以下问题并写入"问题诊断"区：

| 检测项 | 触发条件 | 严重程度 |
|:------:|:--------:|:--------:|
| 科目空白 | 某科目整周 0 任务 | 🔴 |
| 完成率过低 | 周均完成率 < 60% | 🔴 |
| 连续缺计划 | ≥ 3 天无计划文件 | 🟡 |
| 错题集中 | 单知识点 ≥ 3 条错题 | 🟡 |
| 复盘未填 | ≥ 3 天复盘表空白 | 🟡 |

## 边界条件

- 本周无任何计划文件：输出空报告骨架 + 醒目警告
- 只有 1-2 天数据：标注"数据不足，仅供参考"
- 错题目录不存在：跳过错题分析，不报错
