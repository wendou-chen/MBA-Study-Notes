---
name: math-problem-solver
description: 解答数学问题并以 Obsidian 可渲染的公式格式输出。适用于用户提问数学题、求解、计算、证明、推导、公式、方程等数学相关问题时触发。回答直接使用 $...$ 和 $$...$$ 书写公式，而不是代码块。
---

# 数学问题解答 Skill

当用户提出数学相关问题时，按照以下规范进行回答。

## 工作流程（意图触发分支）

根据用户的指令词区分工作模式，**这是最关键的一步**：

### 场景 A：纯解答模式（隐式触发，没有特殊关键词）
- **触发条件**：用户直接发题图片或文字，**且没有**发特定的收录指令词。
- **动作**：仅在聊天窗口给出排版精美的解答，**绝对不要**读写或修改任何本地 Markdown 文件。

### 场景 B：收录解答双轨模式（显式触发词：`/上板` 或 `/解题板`）
- **触发条件**：用户发送数学题图片或文字时，明确包含了关键词 `/上板` 或 `/解题板`。
- **动作**：
  1. 计算并解答题目。
  2. 如果带有图片，将图片保存到对应的 `images/` 目录下（可用 `study-notes-image-organization` 等技能）。
  3. 自动将题目原图（`![[...]]`）与完整的解答内容**追加写入**（Append）到目标错题本或 `考研数学/错题/解题板.md` 末尾。
  4. 终端回复：“✅ 已解答并成功收录至解题板”。

### 场景 C：追问与疑难辨析
- **触发条件**：用户对现有笔记的解答，或刚刚在聊天框中的解答提出疑问。
- **动作**：如果是针对聊天框的，直接回答；如果是针对文件里的，使用追加模式写入 `## 🤔 疑难辨析（用户追问）` 章节。

## ⚠️ 核心规则（必须遵守）

1. **绝对禁止**将公式放入 ` ``` ` 或 ` ```latex ` 代码块中
2. **绝对禁止**使用反引号 `` ` `` 包裹任何公式
3. **必须**使用标准 LaTeX 书写公式：行内用 `$...$`，独立行用 `$$...$$`
4. 所有回答使用**中文**
5. 解题过程用**自然语言 + 公式混排**，像手写在纸上一样让人直接看懂

## 输出规则

### 本地文件输出（仅在触发场景 B 或要求收录时使用）

不再是全量覆写，而是采用**追加模式**写入到文件末尾（比如 `解题板.md`）：

```markdown

---
### 📝 新增题目（{{当天日期 YYYY-MM-DD}}）

![[...引用用户的图片名...]]

（完整解答内容，使用标准 LaTeX 公式，详见下方【回答结构】）
```

### 聊天对话框输出

- **如果是场景 A**：在聊天框直接打印完整的详细解题步骤（使用详尽的自然语言 + LaTeX公式）。完全取代原本只在终端输出摘要的行为。
- **如果是场景 B**：在给出解答的核心步骤或最终答案后，附加一句提醒：“✅ 完整解答已追加写入 `解题板.md`（或其他错题本），请在 Obsidian 中查看排版效果。”

### 追问/辨析输出（追加模式）

当用户对现有解答提出疑问时，不要覆盖原文，而在文末追加：

```markdown
---
（原有内容保持不变...）

## 🤔 疑难辨析（用户追问）

**Q：用户的疑问**
（引用用户的具体问题）

**A：分析与解答**
（针对性解释，可以引用上面的步骤）
```

### 自动错题收录选项（仅在本地追加收录时）

在执行场景 B 并追加到文件末尾后，可以在笔记中留下供用户勾选的错题归档选项：

    ## 📥 错题归档与状态
    - [ ] 归档至：<自动推断的最可能章节>
    - [ ] 归档至：<次选章节>（如有）
    - [ ] 掌握度：🟢 完全掌握 / 🟡 需要复习 / 🔴 仍有疑问

章节从以下固定列表中选择：微分方程 / 无穷级数 / 多元函数积分 / 一元函数积分 / 微分学 / 线性代数 / 概率论
用户在 Obsidian 中标记状态和勾选后，便于后续配合 `error-review-scheduler` 进行复习。

## LaTeX 公式规范

### 行内公式

用 `$...$` 包裹，如：设函数 $f(x) = x^2 + 1$，求 $f'(x)$。

### 独立行公式

用 `$$...$$` 包裹，如：

$$\int_0^\infty e^{-x^2} dx = \frac{\sqrt{\pi}}{2}$$

### 多行对齐推导

使用 `aligned` 环境：

$$\begin{aligned}
f(x) &= (x+1)^2 \\
&= x^2 + 2x + 1
\end{aligned}$$

### 矩阵

使用 `pmatrix`、`bmatrix` 等环境：

$$A = \begin{pmatrix} a_{11} & a_{12} \\ a_{21} & a_{22} \end{pmatrix}$$

### 分段函数

使用 `cases` 环境：

$$f(x) = \begin{cases} x^2, & x \geq 0 \\ -x, & x < 0 \end{cases}$$

## 回答结构

### 标准格式（写入文件的内容）

**📝 题目**（复述或简述题目，可省略）

**💡 解题思路**：简述采用的方法和关键想法。

**📐 详细步骤**

第一步：描述操作
（展示推导过程）

第二步：继续推导
...

**✅ 最终答案**：用加粗或框线突出最终结果。

### 注意事项

- 每一步都要有**文字说明**，不要只列公式
- 关键变量首次出现时要解释含义
- 复杂推导可以拆成小步，每步有过渡语句
- 如果有多种解法，优先给出最直观的

## 完整示例

以下是写入 `考研数学/解题板.md` 的内容示例：

---

**📝 题目**

求不定积分 $\displaystyle\int \frac{x}{\sqrt{1+x^2}} \, dx$。

**💡 解题思路**

注意到被积函数的分子 $x$ 恰好是分母中 $1+x^2$ 求导后的一部分，因此考虑**凑微分法**。

**📐 详细步骤**

**第一步：识别微分关系**

注意到 $d(1+x^2) = 2x \, dx$，即 $x \, dx = \frac{1}{2} d(1+x^2)$。

**第二步：换元**

令 $u = 1 + x^2$，则：

$$\int \frac{x}{\sqrt{1+x^2}} \, dx = \frac{1}{2} \int \frac{du}{\sqrt{u}}$$

**第三步：计算积分**

$$\begin{aligned}
\frac{1}{2} \int u^{-1/2} \, du &= \frac{1}{2} \cdot 2u^{1/2} + C \\
&= \sqrt{u} + C
\end{aligned}$$

**第四步：回代**

将 $u = 1 + x^2$ 代回，得到：

$$\int \frac{x}{\sqrt{1+x^2}} \, dx = \sqrt{1+x^2} + C$$

**✅ 最终答案**

$$\boxed{\int \frac{x}{\sqrt{1+x^2}} \, dx = \sqrt{1+x^2} + C}$$

---
