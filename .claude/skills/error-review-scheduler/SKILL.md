---
name: error-review-scheduler
description: 错题间隔复习调度器。扫描所有错题文件，根据错误次数和日期计算间隔复习计划，输出今日待复习清单。当用户说"/复习错题"、"今天复习什么"、或在早安流程中触发。
---

# 错题间隔复习调度器

基于间隔重复原理，自动计算每道错题的复习时间节点，防止遗忘。

## 触发

- 用户输入 `/复习错题` 或 "今天该复习哪些错题"
- 可集成到 planner 早安流程

## 工作流

### 1. 扫描错题文件

用 Glob 查找所有匹配 `考研数学/错题/*/*.md` 的文件。

### 2. 解析每条错题

每条错题的格式（与微分方程错题.md 一致）：

```markdown
![[images/Pasted image YYYYMMDDHHMMSS.png]]
- **错误次数**: N
- **错误知识点**: 知识点名称
- **详细错误原因**: 原因描述
```

解析规则：
- **日期提取**：从图片文件名 `Pasted image YYYYMMDDHHMMSS.png` 提取前 8 位作为错题记录日期（`YYYYMMDD`）
- **错误次数**：正则 `/\*\*错误次数\*\*:\s*(\d+)/` 提取数字
- **错误知识点**：正则 `/\*\*错误知识点\*\*:\s*(.+)/` 提取文本
- **所属章节**：从文件路径 `考研数学/错题/<章节>/` 提取

### 3. 间隔复习算法

根据错误次数决定复习间隔天数：

| 错误次数 | 复习间隔（天） | 理由 |
|:--------:|:--------------:|:----:|
| ≥ 2 | 1, 3, 7, 14, 30 | 高频错误，密集复习 |
| = 1 | 3, 7, 21, 60 | 偶发错误，正常间隔 |

计算逻辑（伪代码）：
```
today = 当前日期
for each 错题:
    record_date = 图片文件名中的日期
    intervals = 错误次数 >= 2 ? [1,3,7,14,30] : [3,7,21,60]
    review_dates = intervals.map(d => record_date + d天)
    if today in review_dates:
        加入今日复习清单
```

**宽容匹配**：如果恰好的复习日已过但在 ±1 天内，仍然加入清单并标注"补复习"。

### 4. 输出今日复习清单

按章节分组，输出 Markdown 格式：

```markdown
# 📖 今日错题复习清单（YYYY-MM-DD）

> [!info] 共 N 道错题待复习

## 微分方程（X 道）

### 1. 错误知识点名称
- 📅 记录日期：YYYY-MM-DD
- 🔄 错误次数：N
- 📍 复习轮次：第 X 轮（间隔 Y 天）
- 💡 错误原因：原因摘要
- 🖼️ 原题：![[images/Pasted image YYYYMMDDHHMMSS.png]]

---

## 无穷级数（X 道）
...
```

### 5. 无待复习时的输出

如果今日无错题需要复习：

```markdown
> [!success] 今日无错题待复习 ✓
>
> 下次最近复习日：YYYY-MM-DD（N 道）
```

## 附加功能

### 复习统计总览

当用户输入 `/复习统计` 时，输出所有错题的复习进度：

```markdown
| 章节 | 总题数 | 已完成全部轮次 | 进行中 | 未开始 |
```

### 与每日计划集成

可在早安流程中自动调用，将待复习错题作为一条任务插入每日计划：

```markdown
- [ ] 复习时段 | 🔢 数学 | 错题复习 **N 道**（微分方程 X + 无穷级数 Y）
```

## 边界条件

- 图片文件名无法解析日期时，跳过该条并警告
- 错题文件为空时，跳过
- 同一条错题如果有多个复习日同时命中，只显示一次（取最近轮次）
